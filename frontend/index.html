<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ViruScan AI ‚Äî Auth Demo</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <!-- Google Fonts -->
  <link rel="stylesheet" href="style.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Changa:wght@400;500;700&display=swap" rel="stylesheet">

</head>
<body>
  <!-- NAVIGATION -->
<nav>
  <ul>
   <li class="dropdown">
  <a href="#" id="helpBtn"><i class="fa-solid fa-circle-question"></i> Help</a>
</li>
    <li><a href="#" id="aboutBtn"><i class="fa-solid fa-circle-info"></i> About Us</a></li>
  </ul>
  <div class="logo">ViruScan AI</div> 
</nav>

  <!-- HERO -->
  <section class="hero">
    <div class="glass-box">
      <h1>Welcome to <span>ViruScan AI</span></h1>
      <p>Smart protection powered by Artificial Intelligence.</p>

     <div class="side-buttons">
  <button class="signin" id="openLogin">Sign In</button>
   <button class="signin admin-btn" id="openAdmin">Admin</button>
  <a class="signup" id="openSignup" href="#">Create an account</a>
</div>
    </div>
    </div>
  </section>
<!-- ====== AUTH MODAL (Login / Signup) ====== -->
<div id="authModal" class="modal" aria-hidden="true">
  <div class="modal-card" role="dialog" aria-modal="true">
    <span class="close-btn" data-close>&times;</span>
    <h2 id="authTitle">Sign in to <span style="color:#a8dadc">ViruScan AI</span></h2>

    <form id="authForm">
      <!-- login fields -->
      <div id="loginFields">
        <input type="email" id="loginEmail" placeholder="Email address" required />
        <input type="password" id="loginPassword" placeholder="Password" required />
        <div class="small-muted" style="margin-top:6px">
          Don't have an account? <a href="#" id="switchToSignup">Create one</a>
        </div>
        <button type="button" class="primary" id="loginBtn" style="margin-top:12px">Sign in</button>
        <div style="margin-top:8px;text-align:center">
          <a href="#" id="forgotPassword">Forgot password?</a>
        </div>
      </div>

      <!-- signup fields -->
      <div id="signupFields" style="display:none;margin-top:8px">
        <input type="text" id="suFullName" placeholder="Full name" required />
        <input type="email" id="suEmail" placeholder="Email address" required />

        <div class="row">
          <input type="password" id="suPassword" class="half" placeholder="Password" required />
          <input type="password" id="suConfirm" class="half" placeholder="Confirm password" required />
        </div>

        <!-- Phone (ÿ®ŸÑÿØ + ÿ±ŸÇŸÖ) ÿ®ÿØŸàŸÜ ÿ£Ÿä Ÿàÿ≥ŸàŸÖ ŸÖŸàÿØÿßŸÑ ÿØÿßÿÆŸÑŸáÿß -->
        <div class="phone-container">
          <div class="country-select">
            <select id="countryCode">
              <option value="JO" data-code="+962" data-flag="jo">Jordan (+962)</option>
              <option value="SA" data-code="+966" data-flag="sa">Saudi Arabia (+966)</option>
              <option value="EG" data-code="+20"  data-flag="eg">Egypt (+20)</option>
              <option value="US" data-code="+1"   data-flag="us">USA (+1)</option>
            </select>
          </div>
          <input type="text" id="suPhone" placeholder="Enter phone number" required />
        </div>

        <div id="suError" class="error" style="display:none;"></div>
        <button type="button" class="primary" id="signupBtn" style="margin-top:10px">Create account</button>
        <div class="small-muted" style="margin-top:8px">
          Already registered? <a href="#" id="switchToLogin">Sign in</a>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- Admin Login Modal (ŸÖŸÜŸÅÿµŸÑ ÿπŸÜ authModal) -->
<div id="adminModal" class="modal" aria-hidden="true">
  <div class="modal-card" role="dialog" aria-modal="true">
    <span class="close-btn" id="closeAdmin">&times;</span>
    <h2>Admin Login</h2>
    <input type="email" id="adminEmail" placeholder="Admin Email" />
    <input type="password" id="adminPass" placeholder="Password" />
    <button class="primary" id="adminLoginBtn">Sign in</button>
  </div>
</div>

<!-- ====== Forgot Password Modal ====== -->
<div id="forgotModal" class="modal" aria-hidden="true">
  <div class="modal-card" role="dialog" aria-modal="true">
    <span class="close-btn" data-close>&times;</span>
    <h2>Reset your password üîí</h2>
    <p style="margin-bottom:10px;color:#ddd;">Enter your email or phone number to receive a reset code.</p>

    <form id="forgotForm">
      <input type="text" id="forgotInput" placeholder="Email or phone number" required />
      <button type="button" class="primary" id="sendReset">Send reset code</button>

      <!-- ÿßŸÑÿÆÿ∑Ÿàÿ© ÿßŸÑÿ´ÿßŸÜŸäÿ©: ÿ•ÿØÿÆÿßŸÑ ÿßŸÑŸÉŸàÿØ -->
      <div id="codeSection" style="display:none; margin-top:15px;">
        <input type="text" id="resetCode" placeholder="Enter verification code" maxlength="6" />
        <button type="button" class="primary" id="verifyCode">Verify code</button>
      </div>

      <div id="forgotMsg" class="success" style="display:none;margin-top:10px;"></div>
    </form>
  </div>
</div>">

 <!-- About Us Modal -->
<div id="aboutModal" class="modal">
  <div class="modal-card">
    <span class="close-btn" id="closeAbout">&times;</span>
    <h2>About Us</h2>
    <p>
      <strong>ViruScan AI</strong> is an intelligent web-based system designed to detect and analyze
      potential viruses using artificial intelligence. It helps users maintain cybersecurity
      awareness through a simple and modern interface.
    </p>

    <h3>Our Team</h3>
    <div class="team">
      <div class="member">
        <img src="my.png" alt="Member 1">
        <h4>Jomana Jber</h4>
        <p>Developer & Designer</p>
      </div>
      <div class="member">
        <img src="team2.jpg" alt="Member 2">
        <h4>Qusai Bassam</h4>
        <p>Frontend Developer</p>
      </div>
      <div class="member">
        <img src="team3.jpg" alt="Member 3">
        <h4>Leena Khaled</h4>
        <p>Backend Engineer</p>
      </div>
    </div>
  </div>
</div>

<!-- Help Modal -->
<div id="helpModal" class="modal">
  <div class="modal-card">
    <span class="close-btn" data-close="helpModal">&times;</span>
    <h2>Help & Support</h2>

    <div class="accordion">

      <!-- Item 1 -->
      <div class="acc-item">
        <button class="acc-btn">
          How to create your account?
          <i class="fa-solid fa-chevron-down"></i>
        </button>
        <div class="acc-content">
          <p>
            If you already have an account, simply enter your email or phone number along with your password.  
            To create a new account, click on ‚ÄúSign Up‚Äù, then enter your full name, email address, phone number, and password.
          </p>
        </div>
      </div>

      <!-- Item 2 -->
      <div class="acc-item">
        <button class="acc-btn">
          How to scan websites or apps?
          <i class="fa-solid fa-chevron-down"></i>
        </button>
        <div class="acc-content">
          <p>
            After logging in, copy the URL you want to scan or enter the application package name.  
            ViruScan AI will analyze it instantly and show you the risk score and recommended solutions.
          </p>
        </div>
      </div>

      <!-- Item 3 -->
      <div class="acc-item">
        <button class="acc-btn">
          How to contact support?
          <i class="fa-solid fa-chevron-down"></i>
        </button>
        <div class="acc-content">
          <p>
            You can contact our support team via email or the Contact Us page:  
            <br><br>
            üìß Email: <b>ViruScanAI@support.com</b><br>
            üì± Phone: <b>+962 7 XXX XXXX</b>
          </p>
        </div>
      </div>

    </div>

  </div>
</div>

<script>
  const API_BASE = "http://127.0.0.1:8000/api";

/* ---------------------------
   Modal + Auth behavior
--------------------------- */
const showModal = (el) => { el.classList.add('show'); el.setAttribute('aria-hidden','false'); }
const hideModal = (el) => { el.classList.remove('show'); el.setAttribute('aria-hidden','true'); }

const authModal = document.getElementById('authModal');

// openers
document.getElementById('openLogin').addEventListener('click', ()=> {
  document.getElementById('loginFields').style.display='block';
  document.getElementById('signupFields').style.display='none';
  document.getElementById('authTitle').innerHTML = 'Sign in to <span style="color:#a8dadc">ViruScan AI</span>';
  showModal(authModal);
});

document.getElementById('openSignup').addEventListener('click', (e)=> {
  e.preventDefault();
  document.getElementById('signupFields').style.display='block';
  document.getElementById('loginFields').style.display='none';
  document.getElementById('authTitle').innerHTML = 'Create your <span style="color:#a8dadc">ViruScan AI</span> account';
  showModal(authModal);
});

// Switch links
document.getElementById('switchToSignup').addEventListener('click', (e)=> {
  e.preventDefault();
  document.getElementById('loginFields').style.display='none';
  document.getElementById('signupFields').style.display='block';
  document.getElementById('authTitle').innerHTML = 'Create your <span style="color:#a8dadc">ViruScan AI</span> account';
});
document.getElementById('switchToLogin').addEventListener('click', (e)=> {
  e.preventDefault();
  document.getElementById('signupFields').style.display='none';
  document.getElementById('loginFields').style.display='block';
  document.getElementById('authTitle').innerHTML = 'Sign in to <span style="color:#a8dadc">ViruScan AI</span>';
});

/* ---------------------------
   SIGN UP - NOW WITH BACKEND
--------------------------- */
const signupBtn = document.getElementById('signupBtn');
const suPassword = document.getElementById('suPassword');
const suConfirm = document.getElementById('suConfirm');
const suFullName = document.getElementById('suFullName');
const suEmail = document.getElementById('suEmail');
const suPhone = document.getElementById('suPhone');
const suError = document.getElementById('suError');
const countryCode = document.getElementById('countryCode');

signupBtn.addEventListener('click', async ()=>{
  suError.style.display='none';
  const name = suFullName.value.trim();
  const email = suEmail.value.trim();
  const pass = suPassword.value;
  const confirm = suConfirm.value;
  const phone = suPhone.value.trim();
  const prefix = countryCode.selectedOptions[0].getAttribute('data-code');

  if(!name || !email || !pass || !confirm || !phone){
    suError.textContent = '‚ö†Ô∏è Please fill all required fields.';
    suError.style.display='block';
    return;
  }
  if(pass.length < 6){
    suError.textContent = '‚ö†Ô∏è Password must be at least 6 characters.';
    suError.style.display='block';
    return;
  }
  if(pass !== confirm){
    suError.textContent = '‚ö†Ô∏è Passwords do not match.';
    suError.style.display='block';
    return;
  }
  
  const fullPhone = prefix + phone;

  // ‚úÖ NOW CALL BACKEND API
  try {
    signupBtn.disabled = true;
    signupBtn.textContent = 'Creating account...';

    const response = await fetch(`${API_BASE}/users/register`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify({
        email: email,
        full_name: name,
        phone: fullPhone,
        password: pass
      })
    });

    const data = await response.json();

    if (!response.ok) {
      throw new Error(data.error || 'Registration failed');
    }

    // Success
    alert(`‚úÖ Account created successfully!\nEmail: ${email}\nWelcome, ${name}!`);
    
    // Auto-login after signup
    await loginUserAfterSignup(email, pass);
    
    hideModal(authModal);
    suFullName.value = suEmail.value = suPassword.value = suConfirm.value = suPhone.value = '';
    
  } catch (error) {
    suError.textContent = '‚ùå ' + error.message;
    suError.style.display = 'block';
  } finally {
    signupBtn.disabled = false;
    signupBtn.textContent = 'Create account';
  }
});

// Auto-login helper function
async function loginUserAfterSignup(email, password) {
  try {
    const response = await fetch(`${API_BASE}/users/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify({ email, password })
    });

    if (response.ok) {
      const data = await response.json();
      localStorage.setItem('user', JSON.stringify(data.user));
      window.location.href = 'dashboard.html';
    }
  } catch (error) {
    console.error('Auto-login failed:', error);
    window.location.href = 'dashboard.html';
  }
}

/* ---------------------------
   SIGN IN - NOW WITH BACKEND
--------------------------- */
const loginBtn = document.getElementById('loginBtn');

loginBtn.addEventListener('click', async ()=>{
  const email = document.getElementById('loginEmail').value.trim();
  const pass = document.getElementById('loginPassword').value;
  
  if(!email || !pass){ 
    alert('Please fill all fields'); 
    return; 
  }

  try {
    loginBtn.disabled = true;
    loginBtn.textContent = 'Signing in...';

    const response = await fetch(`${API_BASE}/users/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify({ email, password: pass })
    });

    const data = await response.json();

    if (!response.ok) {
      throw new Error(data.error || 'Login failed');
    }

    // Store user info
    localStorage.setItem('user', JSON.stringify(data.user));
    
    alert(`‚úÖ Welcome back, ${data.user.full_name}!`);
    window.location.href = 'dashboard.html';

  } catch (error) {
    alert('‚ùå ' + error.message);
  } finally {
    loginBtn.disabled = false;
    loginBtn.textContent = 'Sign in';
  }
});

/* ---------------------------
   ADMIN LOGIN - NOW WITH BACKEND
--------------------------- */
document.getElementById("openAdmin").addEventListener("click", ()=>{
  document.getElementById("adminModal").classList.add("show");
});

document.getElementById("closeAdmin").addEventListener("click", ()=>{
  document.getElementById("adminModal").classList.remove("show");
});

document.getElementById("adminLoginBtn").addEventListener("click", async ()=> {
  const email = document.getElementById("adminEmail").value.trim();
  const pass = document.getElementById("adminPass").value;

  if (!email || !pass) {
    alert("‚ùå Please fill all fields");
    return;
  }

  try {
    const adminLoginBtn = document.getElementById("adminLoginBtn");
    adminLoginBtn.disabled = true;
    adminLoginBtn.textContent = 'Signing in...';

    const response = await fetch(`${API_BASE}/admin/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify({ email, password: pass })
    });

    const data = await response.json();

    if (!response.ok) {
      throw new Error(data.error || 'Admin login failed');
    }

    // Store admin info
    localStorage.setItem('user', JSON.stringify(data.user));
    localStorage.setItem('isAdmin', 'true');
    
    window.location.href = "admin-dashboard.html";

  } catch (error) {
    alert("‚ùå " + error.message);
    document.getElementById("adminLoginBtn").disabled = false;
    document.getElementById("adminLoginBtn").textContent = 'Sign in';
  }
});

/* ---------------------------
   Country Code Auto-fill
--------------------------- */
countryCode.addEventListener('change', ()=>{
  const code = countryCode.selectedOptions[0].getAttribute('data-code');
  suPhone.value = code + ' ';
  suPhone.focus();
});

suPhone.addEventListener('focus', () => {
  const prefix = countryCode.selectedOptions[0].getAttribute('data-code');
  if (!suPhone.value.startsWith('+')) {
    suPhone.value = prefix;
  }
});

suPhone.addEventListener('input', () => {
  const prefix = countryCode.selectedOptions[0].getAttribute('data-code');
  suPhone.value = prefix + suPhone.value.slice(prefix.length).replace(/\D/g, '');
});

/* ---------------------------
   Close modal handlers
--------------------------- */
document.querySelectorAll('[data-close]').forEach(btn=>{
  btn.addEventListener('click', ()=> hideModal(authModal));
});

window.addEventListener('click', (e)=>{
  if(e.target === authModal){ hideModal(authModal); }
});

/* ---------------------------
   Accordion Logic
--------------------------- */
document.querySelectorAll(".acc-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    btn.classList.toggle("active");
    const content = btn.nextElementSibling;

    if (btn.classList.contains("active")) {
      content.style.maxHeight = content.scrollHeight + "px";
    } else {
      content.style.maxHeight = "0px";
    }
  });
});

// About Us modal
  const aboutModal = document.getElementById("aboutModal");
  const aboutBtn = document.getElementById("aboutBtn");
  const closeAbout = document.getElementById("closeAbout");

  // ŸÅÿ™ÿ≠ ŸÖŸàÿØÿßŸÑ About Us
  aboutBtn.addEventListener("click", (e) => {
    e.preventDefault();
    aboutModal.style.display = "flex";
  });

  // ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÖŸàÿØÿßŸÑ
  closeAbout.addEventListener("click", () => {
    aboutModal.style.display = "none";
  });
  // ÿ•ÿ∞ÿß ÿ∂ÿ∫ÿ∑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿÆÿßÿ±ÿ¨ ÿßŸÑÿ®ÿ∑ÿßŸÇÿ©ÿå Ÿäÿ∫ŸÑŸÇ ÿßŸÑŸÖŸàÿØÿßŸÑ
  window.addEventListener("click", (e) => {
    if (e.target === aboutModal) {
      aboutModal.style.display = "none";
    }
  });

// ÿπŸÜÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©
document.addEventListener('DOMContentLoaded', ()=>{
  const savedLang = localStorage.getItem('siteLanguage') || 'en';
  applyLanguage(savedLang);
});

const historyModal = document.getElementById('historyModal');

// ÿ±ÿ®ÿ∑ ÿ≤ÿ± History ÿ®ÿßŸÑŸÖŸàÿØÿßŸÑ
document.getElementById('historyBtn').addEventListener('click', e => {
  e.preventDefault();
  showModal(historyModal);

});

// ÿ≤ÿ± ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇ
historyModal.querySelector('.close-btn').addEventListener('click', () => {
  hideModal(historyModal);
});

// ÿ•ÿ∫ŸÑÿßŸÇ ÿπŸÜÿØ ÿßŸÑÿ∂ÿ∫ÿ∑ ÿÆÿßÿ±ÿ¨ ÿßŸÑŸÖŸàÿØÿßŸÑ
window.addEventListener('click', e => {
  if(e.target === historyModal) hideModal(historyModal);
});
const contactModal = document.getElementById('contactModal');
const sendContact = document.getElementById('sendContact');

document.getElementById('contactBtn').addEventListener('click', e => {
  e.preventDefault();
  showModal(contactModal);
});

// ÿ≤ÿ± ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ
sendContact.addEventListener('click', () => {
  const name = document.getElementById('contactName').value.trim();
  const email = document.getElementById('contactEmail').value.trim();
  const message = document.getElementById('contactMessage').value.trim();

  if(!name || !email || !message){
    alert('‚ö†Ô∏è Please fill all fields before sending.');
    return;
  }

  alert(`‚úÖ Message sent successfully!\nName: ${name}\nEmail: ${email}\nMessage: ${message}`);
  
  // ŸÖÿ≥ÿ≠ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿ®ÿπÿØ ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ
  document.getElementById('contactForm').reset();
  hideModal(contactModal);
});

// ÿ≤ÿ± ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇ
contactModal.querySelector('.close-btn').addEventListener('click', () => {
  hideModal(contactModal);
});

// ÿ•ÿ∫ŸÑÿßŸÇ ÿπŸÜÿØ ÿßŸÑÿ∂ÿ∫ÿ∑ ÿÆÿßÿ±ÿ¨ ÿßŸÑŸÖŸàÿØÿßŸÑ
window.addEventListener('click', e => {
  if(e.target === contactModal) hideModal(contactModal);
});
const feedbackModal = document.getElementById('feedbackModal');
const stars = document.querySelectorAll('#starRating .star');
let selectedRating = 0;

// ÿ™ŸÅÿπŸäŸÑ ÿ≤ÿ± Feedback ŸÖŸÜ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©
document.getElementById('feedbackBtn').addEventListener('click', e => {
  e.preventDefault();
  showModal(feedbackModal);
});

// ÿ™ŸÅÿπŸäŸÑ ÿßŸÑŸÜÿ¨ŸàŸÖ
stars.forEach(star => {
  star.addEventListener('click', () => {
    selectedRating = parseInt(star.getAttribute('data-value'));
    stars.forEach(s => s.classList.remove('active'));
    stars.forEach(s => {
      if(parseInt(s.getAttribute('data-value')) <= selectedRating) {
        s.classList.add('active');
      }
    });
  });
});

// ÿ≤ÿ± ÿ•ÿ±ÿ≥ÿßŸÑ Feedback
document.getElementById('submitFeedback').addEventListener('click', () => {
  const text = document.getElementById('feedbackText').value.trim();

  if(selectedRating === 0){
    alert('‚ö†Ô∏è Please select a rating before submitting!');
    return;
  }

  alert(`‚úÖ Thanks for your feedback!\nRating: ${selectedRating} ‚≠ê\nMessage: ${text || 'No message provided'}`);

  // ÿ•ÿπÿßÿØÿ© ÿ∂ÿ®ÿ∑ ÿßŸÑŸÖŸàÿØÿßŸÑ ÿ®ÿπÿØ ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ
  document.getElementById('feedbackText').value = '';
  selectedRating = 0;
  stars.forEach(s => s.classList.remove('active'));
  hideModal(feedbackModal);
});

// ÿ≤ÿ± ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇ
feedbackModal.querySelector('.close-btn').addEventListener('click', () => {
  hideModal(feedbackModal);
});

// ÿ•ÿ∫ŸÑÿßŸÇ ÿπŸÜÿØ ÿßŸÑÿ∂ÿ∫ÿ∑ ÿÆÿßÿ±ÿ¨ ÿßŸÑŸÖŸàÿØÿßŸÑ
window.addEventListener('click', e => {
  if(e.target === feedbackModal) hideModal(feedbackModal);
});

</script>
</body>
</html>